<!DOCTYPE html>
<html>
  <head>
    <title>Notetaker</title>
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='icon.png') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/stylesheet.css') }}"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#generateBtn").click(function () {
          generateNotes();
        });

        function generateNotes() {
          // Get input data based on the selected input type
          var inputType = $("input[name='inputType']:checked").val();
          var inputData;

          if (inputType === "textInput") {
            inputData = $("#noteInput").val();
            sendToBackend(inputType, inputData);
          } else {
            // Check if a file is selected
            var fileInput = $("#fileUpload")[0];
            var file = fileInput.files[0];

            if (!file) {
              // If no file is selected, do nothing
              return;
            } else {
              // Check if the file is a text file
              if (file.type === "text/plain") {
                var reader = new FileReader();

                reader.onload = function (e) {
                  var text = e.target.result;
                  sendToBackend(inputType, text);
                };

                reader.readAsText(file);
              } else {
                // Create a FormData object for non-text files
                var formData = new FormData();
                formData.append("file", file);

                // Send data to the backend
                sendToBackend(inputType, formData);
              }
            }
          }
        }

        function sendToBackend(inputType, inputData) {
          $.ajax({
            type: "POST",
            url: "/generate_notes",
            data: inputData,
            processData: false, // tell jQuery not to process the data
            contentType: false, // tell jQuery not to set contentType
            success: function (response) {
              // Display the generated notes
              $("#outputTextarea").val(response.notes);
              $("#outputDiv").show();
            },
            error: function (error) {
              console.error("Error:", error);
            },
          });
        }
      });
    </script>
  </head>
  <body>
    <h1>Note Taker</h1>

    <div>
      <input
        type="radio"
        id="textInput"
        name="inputType"
        value="textInput"
        checked
      />
      <label for="textInput">Text Input</label>
      <input type="text" id="noteInput" placeholder="Enter text here" />
    </div>

    <div>
      <input type="radio" id="fileInput" name="inputType" value="fileInput" />
      <label for="fileInput">Upload File</label>
      <input type="file" id="fileUpload" />
    </div>

    <button id="generateBtn">Generate Notes</button>

    <div id="outputDiv" style="display: none">
      <h2>Generated Notes</h2>
      <textarea id="outputTextarea" readonly></textarea>
    </div>
  </body>
</html>
